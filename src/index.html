<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kammi</title>
    <style>
        /* ========================================
       CSS VARIABLES - Theme controlled
       ======================================== */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #c4b69c;
            --text-color-dim: rgba(196, 182, 156, 0.4);
            --font-family: Georgia, serif;
            --font-size: 20px;
            --line-height: 1.6;
            /* Reduced from 1.8 */
            --transition-speed: 1200ms;
        }

        /* ... skipped ... */

        /* Style the paragraph elements inside the editor */
        .writing-editor p {
            margin: 0;
            /* No auto-gap. User must hit Enter twice for gap. */
        }

        /* ========================================
       RESET & BASE
       ======================================== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 16px;
            /* Fixed base for UI elements */
            line-height: var(--line-height);
        }

        ::-webkit-scrollbar {
            display: none;
        }

        * {
            scrollbar-width: none;
        }

        /* ========================================
       SCREENS (shared)
       ======================================== */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed) ease,
                visibility var(--transition-speed) ease;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        /* ========================================
       ONBOARDING: NAME
       ======================================== */
        #onboarding-name .onboarding-title {
            font-size: 1.4em;
            font-style: italic;
            margin-bottom: 2rem;
        }

        .onboarding-input {
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--text-color-dim);
            color: var(--text-color);
            font-family: inherit;
            font-size: 1.2em;
            text-align: center;
            padding: 0.5rem;
            width: 300px;
            outline: none;
        }

        .onboarding-input:focus {
            border-color: var(--text-color);
        }

        .onboarding-hint {
            margin-top: 2rem;
            font-size: 0.8em;
            color: var(--text-color-dim);
        }

        /* ========================================
       ONBOARDING: THEME
       ======================================== */
        #onboarding-theme .theme-title {
            font-size: 1.2em;
            margin-bottom: 2rem;
        }

        .theme-options {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .theme-option {
            width: 140px;
            height: 100px;
            border: 2px solid var(--text-color-dim);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: border-color 0.3s, transform 0.2s;
        }

        .theme-option:hover {
            border-color: var(--text-color);
            transform: scale(1.05);
        }

        .theme-option.selected {
            border-color: var(--text-color);
            border-width: 3px;
        }

        .theme-continue {
            margin-top: 2rem;
            padding: 0.8rem 2rem;
            background: transparent;
            border: 1px solid var(--text-color-dim);
            color: var(--text-color);
            font-family: inherit;
            font-size: 1em;
            cursor: pointer;
            opacity: 0.3;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .theme-continue.enabled {
            opacity: 1;
            pointer-events: auto;
        }

        .theme-continue.enabled:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .theme-midnight {
            background: #1a1a1a;
            color: #c4b69c;
        }

        .theme-paper {
            background: #faf8f0;
            color: #4a4a4a;
        }

        .theme-focus {
            background: #ffffff;
            color: #1a1a1a;
        }

        .theme-custom {
            background: linear-gradient(135deg, #1a1a1a 50%, #f5f5dc 50%);
            color: #888;
        }

        /* ========================================
       GREETING SCREEN
       ======================================== */
        #greeting-screen {
            cursor: pointer;
        }

        .greeting-text {
            font-size: 1.6em;
            font-style: italic;
        }

        .greeting-hint {
            margin-top: 3rem;
            font-size: 0.8em;
            color: var(--text-color-dim);
        }

        /* ========================================
       WRITING SCREEN
       ======================================== */
        #writing-screen {
            padding: 15vh 10vw;
            align-items: flex-start;
            justify-content: flex-start;
        }

        /* Tiptap Editor Container */
        #editor-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }

        /* The actual editable area created by Tiptap */
        .writing-editor {
            width: 100%;
            min-height: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: var(--font-size);
            line-height: var(--line-height);
            caret-color: var(--text-color-dim);
        }

        /* Remove default focus outline on Tiptap */
        .writing-editor:focus {
            outline: none;
        }

        /* Style the paragraph elements inside the editor */
        .writing-editor p {
            margin: 0;
            /* No auto-gap. User must hit Enter twice for gap. */
        }

        .writing-editor p:last-child {
            margin-bottom: 0;
        }

        /* Fade trailing text - pen-on-paper focus effect */
        .writing-editor p,
        .writing-editor li {
            transition: opacity 0.4s ease-out;
        }

        .writing-editor [data-fade="1"] {
            opacity: 0.6;
        }

        .writing-editor [data-fade="2"] {
            opacity: 0.35;
        }

        .writing-editor [data-fade="3"] {
            opacity: 0.2;
        }

        .writing-editor [data-fade="4"] {
            opacity: 0.12;
        }

        .writing-editor [data-fade="5"] {
            opacity: 0.08;
        }

        /* Bold and Italic styling - inherits text color */
        .writing-editor strong {
            font-weight: bold;
        }

        .writing-editor em {
            font-style: italic;
        }

        /* Lists */
        .writing-editor ul,
        .writing-editor ol {
            padding-left: 2.5rem;
            /* Increased to prevent number clipping */
            margin: 0 0 1em 0;
        }

        .writing-editor ul {
            list-style-type: disc;
        }

        .writing-editor ol {
            list-style-type: decimal;
        }

        .writing-editor li {
            margin-bottom: 0.1em;
            /* Reduced from 0.5em for tighter lists */
            padding-left: 0.2em;
        }

        .writing-editor li p {
            margin: 0 !important;
            line-height: 1.6;
            /* Slightly tighter line height for list items if needed */
        }

        /* Bubble Menu */
        .bubble-menu {
            display: flex;
            background-color: var(--text-color);
            padding: 0.2rem;
            border-radius: 0.5rem;
            gap: 0.2rem;

            /* Hidden by default so it doesn't show in flow */
            visibility: hidden;
            opacity: 0;

            /* Transition for smooth appearance */
            transition: opacity 0.2s, transform 0.2s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* Only show when Tippy activates it */
        .tippy-box .bubble-menu {
            visibility: visible;
            opacity: 1;
        }

        .bubble-menu-btn {
            background: transparent;
            border: none;
            color: var(--bg-color);
            font-family: sans-serif;
            font-size: 0.8em;
            font-weight: bold;
            padding: 0.2rem 0.5rem;
            border-radius: 0.3rem;
            cursor: pointer;
        }

        .bubble-menu-btn:hover,
        .bubble-menu-btn.is-active {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        /* ========================================
       COGWHEEL (settings shortcut)
       ======================================== */
        .cogwheel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 24px;
            height: 24px;
            opacity: 0.1;
            cursor: pointer;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .cogwheel:hover {
            opacity: 0.5;
        }

        .cogwheel svg {
            fill: var(--text-color);
            width: 100%;
            height: 100%;
        }

        /* ========================================
       ESC MENU
       ======================================== */
        #menu-screen {
            background: rgba(0, 0, 0, 0.9);
            z-index: 200;
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            text-align: center;
        }

        .menu-item {
            font-size: 1.1em;
            color: #c4b69c;
            /* Fixed light color for dark overlay */
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .menu-item:hover {
            opacity: 0.7;
        }

        /* ========================================
       SETTINGS PANEL
       ======================================== */
        #settings-screen {
            background: var(--bg-color);
            z-index: 200;
            padding: 5vh 10vw;
            align-items: flex-start;
            overflow-y: auto;
        }

        .settings-title {
            font-size: 1.4em;
            margin-bottom: 2rem;
        }

        .settings-group {
            margin-bottom: 2rem;
            width: 100%;
            max-width: 600px;
        }

        .settings-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9em;
            color: var(--text-color-dim);
        }

        .settings-input,
        .settings-select {
            width: 100%;
            padding: 0.5rem;
            background: transparent;
            border: 1px solid var(--text-color-dim);
            color: var(--text-color);
            font-family: inherit;
            font-size: 1em;
            outline: none;
        }

        .settings-input:focus,
        .settings-select:focus {
            border-color: var(--text-color);
        }

        .settings-color-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .settings-color-picker {
            width: 50px;
            height: 40px;
            border: none;
            cursor: pointer;
        }

        .settings-slider {
            width: 100%;
        }

        .settings-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        .settings-btn {
            padding: 0.6rem 1.2rem;
            background: transparent;
            border: 1px solid var(--text-color-dim);
            color: var(--text-color);
            cursor: pointer;
            transition: background 0.2s;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body>

    <!-- ONBOARDING: Name -->
    <div id="onboarding-name" class="screen">
        <p class="onboarding-title">Welcome to Kammi.</p>
        <input type="text" id="name-input" class="onboarding-input" placeholder="What should I call you?" autofocus>
        <p class="onboarding-hint">Press Enter to continue</p>
    </div>

    <!-- ONBOARDING: Theme -->
    <div id="onboarding-theme" class="screen">
        <p class="theme-title">Choose your atmosphere</p>
        <div class="theme-options">
            <div class="theme-option theme-midnight" data-theme="midnight">Midnight</div>
            <div class="theme-option theme-paper" data-theme="paper">Paper</div>
            <div class="theme-option theme-focus" data-theme="focus">Focus</div>
            <div class="theme-option theme-custom" data-theme="custom">Custom</div>
        </div>
        <button class="theme-continue" id="theme-continue">Continue</button>
    </div>

    <!-- GREETING -->
    <div id="greeting-screen" class="screen">
        <p class="greeting-text" id="greeting-text"></p>
        <div id="greeting-options" style="margin-top: 2rem; text-align: center;">
            <p id="greeting-continue" style="cursor: pointer; margin-bottom: 1rem; display: none;">Continue your last
                piece</p>
            <p id="greeting-browse"
                style="cursor: pointer; margin-bottom: 1rem; color: var(--text-color-dim); display: none;">Browse all
                sessions</p>
            <div id="session-list"
                style="display: none; margin-bottom: 1rem; max-height: 200px; overflow-y: auto; text-align: left; padding: 0 2rem;">
            </div>
            <p id="greeting-new" class="greeting-hint" style="cursor: pointer;">Start new</p>
        </div>
    </div>

    <!-- WRITING -->
    <div id="writing-screen" class="screen">
        <div class="bubble-menu">
            <button id="bold-btn" class="bubble-menu-btn">Bold</button>
            <button id="italic-btn" class="bubble-menu-btn">Italic</button>
            <div style="width: 1px; background: var(--bg-color); margin: 0 0.2rem; opacity: 0.5;"></div>
            <button id="bullet-btn" class="bubble-menu-btn">List</button>
            <button id="number-btn" class="bubble-menu-btn">123</button>
        </div>
        <div id="editor-container"></div>
    </div>

    <!-- COGWHEEL -->
    <div class="cogwheel" id="cogwheel" title="Settings">
        <svg viewBox="0 0 24 24">
            <path
                d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96a7.09 7.09 0 00-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 00-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.49.37 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.61 3.61 0 018.4 12 3.61 3.61 0 0112 8.4a3.61 3.61 0 013.6 3.6 3.61 3.61 0 01-3.6 3.6z" />
        </svg>
    </div>

    <!-- ESC MENU -->
    <div id="menu-screen" class="screen">
        <div class="menu-items">
            <div class="menu-item" id="menu-resume">Resume</div>
            <div class="menu-item" id="menu-settings">Settings</div>
            <div class="menu-item" id="menu-privacy">Privacy</div>
            <div class="menu-item" id="menu-support">Support</div>
            <div class="menu-item" id="menu-quit" style="margin-top: 1rem; opacity: 0.6;">Quit</div>
        </div>
    </div>

    <!-- SETTINGS -->
    <div id="settings-screen" class="screen">
        <h2 class="settings-title">Settings</h2>

        <div class="settings-group">
            <label class="settings-label">Your Name</label>
            <input type="text" id="settings-name" class="settings-input">
        </div>

        <div class="settings-group">
            <label class="settings-label">Quick Themes</label>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <div class="theme-preset" data-theme="midnight"
                    style="width: 80px; height: 50px; background: #1a1a1a; color: #c4b69c; border: 1px solid var(--text-color-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75em;">
                    Midnight</div>
                <div class="theme-preset" data-theme="paper"
                    style="width: 80px; height: 50px; background: #faf8f0; color: #4a4a4a; border: 1px solid var(--text-color-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75em;">
                    Paper</div>
                <div class="theme-preset" data-theme="focus"
                    style="width: 80px; height: 50px; background: #ffffff; color: #1a1a1a; border: 1px solid var(--text-color-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75em;">
                    Focus</div>
                <div class="theme-preset" data-theme="saved" id="saved-theme-tile"
                    style="width: 80px; height: 50px; border: 2px dashed var(--text-color-dim); display: none; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75em;">
                    Saved</div>
            </div>
            <button id="save-theme-btn" class="settings-btn" style="margin-top: 0.75rem; font-size: 0.85em;">Save
                Current</button>
        </div>

        <div class="settings-group">
            <label class="settings-label">Font</label>
            <div id="font-options" style="display: flex; flex-direction: column; gap: 0.5rem;">
                <div class="font-option" data-font="Georgia, serif"
                    style="font-family: Georgia, serif; padding: 0.5rem; border: 1px solid var(--text-color-dim); cursor: pointer;">
                    Georgia — warm, designed for screens</div>
                <div class="font-option" data-font="Palatino, 'Palatino Linotype', serif"
                    style="font-family: Palatino, 'Palatino Linotype', serif; padding: 0.5rem; border: 1px solid var(--text-color-dim); cursor: pointer;">
                    Palatino — literary, quietly elegant</div>
                <div class="font-option" data-font="'Courier New', monospace"
                    style="font-family: 'Courier New', monospace; padding: 0.5rem; border: 1px solid var(--text-color-dim); cursor: pointer;">
                    Courier New — typewriter rhythm</div>
            </div>
            <input type="hidden" id="settings-font" value="Georgia, serif">
        </div>

        <div class="settings-group">
            <label class="settings-label">Font Size: <span id="font-size-value">20</span>px</label>
            <input type="range" id="settings-fontsize" class="settings-slider" min="14" max="32" value="20">
            <div id="font-size-preview"
                style="margin-top: 0.5rem; padding: 0.5rem; border: 1px dashed var(--text-color-dim); font-size: 20px;">
                Preview text at this size
            </div>
        </div>

        <div class="settings-group">
            <label class="settings-label">Effects</label>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <input type="checkbox" id="settings-fade-effect" checked>
                <label for="settings-fade-effect" style="cursor: pointer;">Fade trailing text (pen-on-paper
                    focus)</label>
            </div>
        </div>

        <div class="settings-group">
            <label class="settings-label">Background Color</label>
            <div class="settings-color-row">
                <input type="color" id="settings-bgcolor" class="settings-color-picker" value="#1a1a1a">
                <input type="text" id="settings-bgcolor-hex" class="settings-input" value="#1a1a1a" style="width:120px">
            </div>
        </div>

        <div class="settings-actions">
            <button class="settings-btn" id="settings-save">Save</button>
            <button class="settings-btn" id="settings-cancel">Cancel</button>
        </div>
    </div>

    <!-- Load the bundled renderer script -->
    <script type="module" src="./renderer.js"></script>
</body>

</html>